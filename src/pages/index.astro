---
/** src/pages/index.astro */
type Post = {
  title: string
  pubDate?: string | Date
  description?: string
  heroImage?: string
  url: string
};

// blog ディレクトリの .md / .mdx をまとめて取得（ビルド時に実行）
const modules = import.meta.glob('./blog/*.{md,mdx}', { eager: true }) as Record<string, any>

const posts: Post[] = Object.values(modules).map((m: any) => ({
  title: m.frontmatter?.title ?? '(タイトル未設定)',
  pubDate: m.frontmatter?.pubDate,
  description: m.frontmatter?.description,
  heroImage: m.frontmatter?.heroImage,
  url: m.url, // ← Astro が自動で解決してくれる公開URL
}))

// 新しい順に並べ替え
posts.sort((a, b) => new Date(b.pubDate ?? 0).getTime() - new Date(a.pubDate ?? 0).getTime())
---

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>ホーム | 事務所サイト</title>
    <style>
      :root { --gap: 1.2rem; }
      body { font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; margin: 0; color: #222; }
      .wrap { max-width: 980px; margin: 0 auto; padding: 28px 16px 56px; }
      h1 { font-size: 28px; margin: 0 0 1rem; }
      .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--gap); }
      .card { display: block; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; text-decoration: none; color: inherit; background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,.04); transition: transform .05s ease, box-shadow .15s ease; }
      .card:hover { transform: translateY(-1px); box-shadow: 0 6px 18px rgba(0,0,0,.08); }
      .thumb { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-radius: 8px; margin-bottom: 12px; background:#f5f5f5; }
      .title { font-size: 18px; font-weight: 700; margin: 0 0 6px; }
      .meta { font-size: 12px; color: #6b7280; margin-bottom: 8px; }
      .desc { font-size: 14px; color:#374151; }
      .empty { color:#6b7280; padding: 16px; border:1px dashed #ddd; border-radius:8px; }
      header { margin-bottom: 24px; display:flex; align-items:center; justify-content:space-between; }
      header a { color:#2563eb; text-decoration:none; }
      header a:hover { text-decoration:underline; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>最新ブログ</h1>
        <a href="/blog/">ブログ一覧へ</a>
      </header>

      {posts.length === 0 ? (
        <p class="empty">まだ記事がありません。CMSで公開するとここに表示されます。</p>
      ) : (
        <div class="grid">
          {posts.map(p => (
            <a class="card" href={p.url}>
              {p.heroImage && <img class="thumb" src={p.heroImage} alt="" />}
              <h2 class="title">{p.title}</h2>
              <div class="meta">
                {p.pubDate && new Date(p.pubDate).toLocaleDateString('ja-JP')}
              </div>
              {p.description && <p class="desc">{p.description}</p>}
            </a>
          ))}
        </div>
      )}
    </div>
  </body>
</html>
